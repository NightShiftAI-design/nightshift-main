<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NightShift AI • Elite Dashboard</title>

  <meta name="robots" content="noindex,nofollow" />
  <meta name="color-scheme" content="dark light" />

  <!-- FAVICONS -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <!-- Icons (Font Awesome) -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --accent: #6ea8ff;
      --good: #42d392;
      --warn: #ffcc66;
      --bad:  #ff6b6b;
      --shadow: 0 14px 46px rgba(0,0,0,.42);
      --radius: 18px;
      --radius2: 14px;
      --ring: 0 0 0 3px rgba(110,168,255,.20);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    html:not(.dark){
      --bg: #f6f7fb;
      --panel: rgba(10,15,25,.04);
      --panel2: rgba(10,15,25,.07);
      --border: rgba(10,15,25,.10);
      --text: rgba(10,15,25,.92);
      --muted: rgba(10,15,25,.62);
      --shadow: 0 12px 30px rgba(10,15,25,.10);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(110,168,255,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(66,211,146,.10), transparent 55%),
        radial-gradient(900px 700px at 50% 110%, rgba(255,204,102,.08), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    /* ========== TOP NAV (Elite-only) ========== */
    .topnav{
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(180deg, rgba(11,16,32,.92), rgba(11,16,32,.72));
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    html:not(.dark) .topnav{
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
      border-bottom-color: rgba(10,15,25,.10);
    }
    .topnavInner{
      max-width: 1400px;
      margin: 0 auto;
      padding: 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .navLeft, .navRight{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .navBrand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color: inherit;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      flex: 0 0 auto;
    }
    .navBrand:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.08);
    }
    html:not(.dark) .navBrand:hover{
      background: rgba(10,15,25,.04);
      border-color: rgba(10,15,25,.10);
    }
    .navBrand .mark{
      width: 36px; height: 36px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(110,168,255,.16);
      border: 1px solid rgba(110,168,255,.28);
      font-weight: 950;
      letter-spacing: .02em;
    }
    .navBrandText{
      display:flex;
      flex-direction:column;
      line-height: 1.05;
      min-width: 0;
    }
    .navBrandText b{ font-weight: 950; font-size: 13px; }
    .navBrandText small{
      color: var(--muted);
      font-size: 11px;
      margin-top: 3px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 260px;
    }

    .menu{
      display:flex;
      align-items:center;
      gap: 4px;
      padding: 6px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      overflow:auto;
      max-width: 760px;
      scrollbar-width: none;
    }
    .menu::-webkit-scrollbar{ display:none; }
    html:not(.dark) .menu{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }

    .navItem{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text);
      text-decoration:none;
      font-weight: 900;
      font-size: 13px;
      white-space: nowrap;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .navItem i{ opacity:.92; }
    .navItem:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.10);
      transform: translateY(-1px);
    }
    html:not(.dark) .navItem:hover{
      background: rgba(10,15,25,.04);
      border-color: rgba(10,15,25,.10);
    }
    .navItem.active{
      background: linear-gradient(180deg, rgba(110,168,255,.24), rgba(110,168,255,.12));
      border-color: rgba(110,168,255,.40);
      box-shadow: 0 0 0 3px rgba(110,168,255,.12);
    }

    .navSearch{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      min-width: 240px;
      max-width: 520px;
      flex: 1 1 320px;
    }
    html:not(.dark) .navSearch{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .navSearch i{ color: var(--muted); }
    .navSearch input{
      width: 100%;
      border: 0;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 13px;
    }

    .navIconBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    html:not(.dark) .navIconBtn{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .navIconBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.07);
      border-color: rgba(110,168,255,.35);
    }

    /* Dropdown */
    .dd{ position: relative; }
    .ddPanel{
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      min-width: 320px;
      max-width: 420px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(11,16,32,.92);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      padding: 10px;
      display:none;
    }
    html:not(.dark) .ddPanel{
      background: rgba(255,255,255,.92);
      border-color: rgba(10,15,25,.12);
    }
    .dd.open .ddPanel{ display:block; }
    .ddGrid{ display:grid; grid-template-columns: 1fr; gap: 6px; }
    .ddDivider{
      height: 1px;
      background: rgba(255,255,255,.10);
      margin: 8px 6px;
    }
    html:not(.dark) .ddDivider{ background: rgba(10,15,25,.10); }

    /* ========== PAGE LAYOUT ========== */
    .page{
      max-width: 1400px;
      margin: 0 auto;
      padding: 18px;
    }
    :target{ scroll-margin-top: 92px; }

    .subhead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      padding: 8px 6px 12px;
    }
    .subhead h1{
      margin:0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: .01em;
    }
    .subhead p{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      max-width: 860px;
    }

    .controls{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items:center;
      justify-content:flex-end;
      min-width: 280px;
    }
    .chip{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
    }
    .chip label{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .chip select, .chip input{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      outline:none;
      min-width: 140px;
    }
    html:not(.dark) .chip select, html:not(.dark) .chip input{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .chip select:focus, .chip input:focus{ box-shadow: var(--ring); }

    .grid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      padding: 8px 6px 0;
    }
    @media (max-width: 1200px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px){ .grid{ grid-template-columns: 1fr; } }

    /* ========== KPI BUBBLES (Elite) ========== */
    .kpi{
      position: relative;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(140px 80px at 20% 20%, rgba(110,168,255,.25), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      padding: 14px 16px 16px;
      min-width: 0;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.04),
        0 18px 40px rgba(0,0,0,.35);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      overflow:hidden;
    }
    html:not(.dark) .kpi{
      background:
        radial-gradient(140px 80px at 20% 20%, rgba(110,168,255,.18), transparent 60%),
        linear-gradient(180deg, rgba(10,15,25,.06), rgba(10,15,25,.02));
      box-shadow:
        inset 0 0 0 1px rgba(10,15,25,.03),
        0 18px 40px rgba(10,15,25,.10);
      border-color: rgba(10,15,25,.12);
    }
    .kpi:hover{
      transform: translateY(-2px);
      border-color: rgba(110,168,255,.45);
      box-shadow:
        inset 0 0 0 1px rgba(110,168,255,.25),
        0 22px 60px rgba(0,0,0,.45);
    }
    .kpiTop{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom: 6px;
      min-width: 0;
    }
    .kpiIcon{
      width: 36px;
      height: 36px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(110,168,255,.18);
      border: 1px solid rgba(110,168,255,.35);
      color: rgba(110,168,255,.95);
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      flex: 0 0 auto;
    }
    html:not(.dark) .kpiIcon{
      box-shadow: 0 10px 24px rgba(10,15,25,.10);
    }
    .kpi .name{
      margin:0;
      font-size: 11px;
      color: var(--muted);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-weight: 900;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .kpi .value{
      margin: 6px 0 0;
      font-size: 24px;
      font-weight: 950;
      letter-spacing: .01em;
    }
    .kpi:after{
      content:"";
      position:absolute;
      inset: auto auto -24px -24px;
      width: 80px;
      height: 80px;
      background: rgba(110,168,255,.18);
      filter: blur(28px);
      border-radius: 999px;
      pointer-events:none;
    }
    .kpi.good .kpiIcon{
      background: rgba(66,211,146,.18);
      border-color: rgba(66,211,146,.35);
      color: var(--good);
    }
    .kpi.good:after{ background: rgba(66,211,146,.18); }
    .kpi.warn .kpiIcon{
      background: rgba(255,204,102,.18);
      border-color: rgba(255,204,102,.35);
      color: var(--warn);
    }
    .kpi.warn:after{ background: rgba(255,204,102,.18); }
    .kpi.bad .kpiIcon{
      background: rgba(255,107,107,.16);
      border-color: rgba(255,107,107,.30);
      color: var(--bad);
    }
    .kpi.bad:after{ background: rgba(255,107,107,.16); }

    /* ========== TIER A: OPS STRIP + MINI CARDS ========== */
    .opsStrip{
      margin: 12px 6px 0;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 240px at 10% 0%, rgba(110,168,255,.14), transparent 60%),
        radial-gradient(900px 240px at 90% 0%, rgba(66,211,146,.10), transparent 60%),
        rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    html:not(.dark) .opsStrip{
      border-color: rgba(10,15,25,.12);
      background:
        radial-gradient(900px 240px at 10% 0%, rgba(110,168,255,.12), transparent 60%),
        radial-gradient(900px 240px at 90% 0%, rgba(66,211,146,.08), transparent 60%),
        rgba(10,15,25,.02);
      box-shadow: 0 12px 30px rgba(10,15,25,.10);
    }
    .opsLeft{
      display:flex; align-items:center; gap: 12px; flex-wrap:wrap; min-width: 0;
    }
    .opsTitle{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      min-width: 0;
    }
    html:not(.dark) .opsTitle{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .opsTitle .dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: rgba(66,211,146,.9);
      box-shadow: 0 0 0 4px rgba(66,211,146,.12);
      flex: 0 0 auto;
    }
    .opsTitle b{ font-weight: 950; font-size: 13px; }
    .opsTitle small{
      display:block;
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 520px;
    }
    .opsMeta{
      display:flex; gap: 8px; align-items:center; flex-wrap:wrap;
    }
    .chipMini{
      display:flex; align-items:center; gap: 8px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
    }
    html:not(.dark) .chipMini{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .chipMini i{ color: rgba(110,168,255,.95); }
    .opsActions{ display:flex; gap: 10px; align-items:center; flex-wrap:wrap; }

    .miniGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 1100px){ .miniGrid{ grid-template-columns: 1fr; } }

    .miniCard{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding: 12px;
      overflow:hidden;
    }
    html:not(.dark) .miniCard{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .miniHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .miniHead b{
      font-size: 12px;
      font-weight: 950;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .miniHead b i{ color: rgba(110,168,255,.95); }

    .chartWrap{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      padding: 10px;
      overflow:hidden;
    }
    html:not(.dark) .chartWrap{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.02);
    }
    canvas.miniChart{
      width: 100%;
      height: 88px;
      display:block;
    }

    .todo{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-top: 6px;
    }
    .todoItem{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }
    html:not(.dark) .todoItem{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .todoItem i{
      margin-top: 2px;
      color: rgba(255,204,102,.95);
      flex: 0 0 auto;
    }
    .todoItem b{ color: var(--text); font-weight: 950; }

    /* ========== CARDS ========== */
    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      overflow:hidden;
      min-width: 0;
      box-shadow: var(--shadow);
    }
    .cardHead{
      padding: 12px 12px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid var(--border);
    }
    .cardHead h3{
      margin:0;
      font-size: 13px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .cardBody{ padding: 12px; }

    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(110,168,255,.14);
      white-space:nowrap;
    }

    .btn{
      border-radius: 14px;
      padding: 11px 12px;
      font-weight: 900;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      user-select:none;
      gap: 10px;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: var(--panel2);
      border-color: rgba(110,168,255,.35);
    }
    .btn:focus{ outline:none; box-shadow: var(--ring); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(110,168,255,.28), rgba(110,168,255,.16));
      border-color: rgba(110,168,255,.45);
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      padding: 12px;
      border-radius: 14px;
      border: 1px dashed var(--border);
      background: rgba(255,255,255,.03);
      line-height: 1.45;
    }

    .layout{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: 14px;
      align-items:start;
      margin-top: 14px;
    }
    @media (max-width: 1100px){
      .layout{ grid-template-columns: 1fr; }
    }

    /* ========== TABLE ========== */
    .tableWrap{
      overflow:auto;
      border-radius: var(--radius2);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      max-width: 100%;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      min-width: 980px;
      table-layout: fixed;
    }
    thead th{
      text-align:left;
      padding: 12px 10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      position: sticky;
      top: 0;
      z-index: 2;
      white-space: nowrap;
      backdrop-filter: blur(10px);
    }
    tbody td{
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      font-size: 13px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      vertical-align: top;
    }
    tbody tr:hover td{ background: rgba(110,168,255,.07); }

    .emptyState{
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 26px 14px;
      border-radius: var(--radius2);
      border: 1px dashed rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    html:not(.dark) .emptyState{
      border-color: rgba(10,15,25,.18);
      background: rgba(10,15,25,.03);
    }
    .emptyState .icon{
      width: 54px; height: 54px;
      border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(110,168,255,.12);
      border: 1px solid rgba(110,168,255,.22);
      color: rgba(110,168,255,.95);
      margin: 0 auto 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
    }
    html:not(.dark) .emptyState .icon{
      box-shadow: 0 10px 24px rgba(10,15,25,.10);
    }
    .emptyState h4{
      margin: 0;
      color: var(--text);
      font-weight: 950;
      font-size: 14px;
    }
    .emptyState p{
      margin: 8px 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    /* State box (used by app.js) */
    #stateBox{
      padding: 12px;
      border-radius: var(--radius2);
      border: 1px dashed var(--border);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      white-space: pre-wrap;
      margin-top: 10px;
    }
    #stateBox:empty{ display:none; }

    /* Toast (used by app.js) */
    #toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      max-width: 360px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(10,15,25,.72);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      font-size: 13px;
      opacity: 0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 99;
    }
    html:not(.dark) #toast{ background: rgba(255,255,255,.78); }
    #toast.show{ opacity:1; transform: translateY(0); }

    /* ========== AUTH OVERLAY (used by app.js) ========== */
    #authOverlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 999;
    }
    html:not(.dark) #authOverlay{ background: rgba(10,15,25,.22); }

    .authCard{
      width: min(520px, 100%);
      border-radius: 22px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .authHead{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .authHead b{ font-size: 14px; }
    .authHead span{ font-size: 12px; color: var(--muted); }

    .authBody{ padding: 16px; }
    .authBody p{ margin:0 0 12px; color: var(--muted); font-size: 13px; line-height:1.5; }

    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom: 12px; }
    .field label{ font-size: 12px; color: var(--muted); }
    .field input{
      width:100%;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px;
      border-radius: 14px;
      outline:none;
      font-size: 14px;
    }
    html:not(.dark) .field input{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .field input:focus{ box-shadow: var(--ring); }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .spacer{ flex:1; }

    .overlayBackRow{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
    }
    .overlayBackRow a{
      color: var(--muted);
      font-size: 12px;
      text-decoration:none;
      border-bottom: 1px dashed transparent;
    }
    .overlayBackRow a:hover{
      color: var(--text);
      border-bottom-color: rgba(110,168,255,.45);
    }

    /* Mobile nav */
    .mobileToggle{ display:none; }
    @media (max-width: 900px){
      .menu{ display:none; }
      .mobileToggle{ display:inline-flex; }
      .navSearch{ min-width: 0; flex: 1 1 auto; }
    }
    .mobileMenu{
      display:none;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 18px 12px;
    }
    .mobileMenu.open{ display:block; }
    .mobileMenu .menu{ display:flex; max-width: 100%; }

    /* Small UI bits */
    .pill{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      min-width: 0;
    }
    .pill b{ font-size: 13px; }

    .filters{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
    }
    .segBtn{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      white-space: nowrap;
    }
    html:not(.dark) .segBtn{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .segBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: rgba(110,168,255,.28);
    }
    .segBtn.active{
      background: rgba(110,168,255,.16);
      border-color: rgba(110,168,255,.35);
      box-shadow: 0 0 0 3px rgba(110,168,255,.10);
    }

    /* Escalations are not enabled yet (Option B) */
    .segBtn.disabled{
      opacity: .55;
      cursor: not-allowed;
      pointer-events: none;
      filter: grayscale(.15);
    }
    .segBtn.disabled .countBadge{ opacity: .75; }

    .countBadge{
      font-size: 11px;
      font-weight: 950;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--text);
    }
    .countBadge.zero{
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    html:not(.dark) .countBadge{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
  </style>

  <!-- Supabase JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Your config + app logic -->
  <script defer src="/dashboard/config.js"></script>
  <script defer src="/dashboard/app.js?v=1000"></script>
</head>

<body>
  <!-- AUTH OVERLAY (IDs expected by app.js) -->
  <div id="authOverlay" aria-hidden="true">
    <div class="authCard" role="dialog" aria-modal="true" aria-label="Sign in">
      <div class="authHead">
        <div>
          <b>Sign in to Elite Dashboard</b><br/>
          <span>Magic link (email)</span>
        </div>
        <span id="authStatus">Not signed in</span>
      </div>

      <div class="authBody">
        <p>Enter your email and we’ll send a secure magic link.</p>

        <div class="field">
          <label for="authEmail">Email</label>
          <input id="authEmail" type="email" placeholder="you@company.com" autocomplete="email" />
        </div>

        <div class="row">
          <button class="btn primary" id="btnSendLink" type="button">
            <i class="fa-solid fa-paper-plane"></i> Send magic link
          </button>
          <button class="btn" id="btnResendLink" type="button">
            <i class="fa-solid fa-rotate"></i> Resend
          </button>
          <span class="spacer"></span>
          <button class="btn" id="btnCloseAuth" type="button">
            <i class="fa-solid fa-xmark"></i> Close
          </button>
        </div>

        <div class="overlayBackRow">
          <a href="/" aria-label="Back to NightShift AI homepage">← Back to NightShiftAI.com</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Top nav -->
  <header class="topnav" id="topnav">
    <div class="topnavInner">
      <div class="navLeft">
        <a class="navBrand" href="/" aria-label="Back to NightShift AI homepage">
          <div class="mark">NS</div>
          <div class="navBrandText">
            <b>NightShift AI</b>
            <small>Elite • Calls, bookings, summaries & escalation</small>
          </div>
        </a>

        <button class="navIconBtn mobileToggle" id="btnMobileMenu" type="button" aria-label="Open menu">
          <i class="fa-solid fa-bars"></i>
        </button>

        <nav class="menu" aria-label="Primary navigation">
          <a class="navItem active" href="#sec-overview" data-nav="overview" aria-current="page">
            <i class="fa-solid fa-gauge-high"></i> Overview
          </a>
          <a class="navItem" href="#sec-activity" data-nav="activity">
            <i class="fa-solid fa-phone-volume"></i> Calls &amp; bookings
          </a>
          <a class="navItem" href="#sec-escalations" data-nav="escalations">
            <i class="fa-solid fa-shield-halved"></i> Escalations
          </a>
          <a class="navItem" href="#sec-policies" data-nav="policies">
            <i class="fa-solid fa-sitemap"></i> Policies &amp; routing
          </a>
          <a class="navItem" href="#sec-export" data-nav="export">
            <i class="fa-solid fa-file-export"></i> Export
          </a>
        </nav>
      </div>

      <div class="navRight">
        <div class="navSearch" title="Search (guest, phone, event, room, call_id, summary…)">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="searchInput" type="text" placeholder="Search guest, phone, event, room, call_id, summary…" />
        </div>

        <button class="navIconBtn" type="button" aria-label="Help (static)">
          <i class="fa-regular fa-circle-question"></i>
        </button>

        <div class="dd" id="ddUser">
          <button class="navIconBtn" id="btnUserDd" type="button" aria-label="Account menu">
            <i class="fa-regular fa-user"></i>
          </button>

          <div class="ddPanel" style="right:0; left:auto; min-width: 380px;">
            <div style="padding: 6px 6px 10px;">
              <div style="font-weight:950; font-size:13px;">Workspace</div>
              <div style="color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35;">
                Multi-property view, date window, and actions. (Elite focuses on calls, booking intake, clean summaries, and safe escalation.)
              </div>
            </div>

            <div class="ddDivider"></div>

            <div style="padding: 6px;">
              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-hotel" style="margin-right:8px; color:var(--muted);"></i>Property</b>
                <select id="propertySelect" style="border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.06);color:var(--text);padding:8px 10px;outline:none;max-width: 200px;">
                  <option value="__all__">All properties</option>
                </select>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-regular fa-calendar" style="margin-right:8px; color:var(--muted);"></i>Date range</b>
                <span class="badge" id="badgeWindow">—</span>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-layer-group" style="margin-right:8px; color:var(--muted);"></i>Activity items</b>
                <span class="badge" id="badgeCount">0</span>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-lock" style="margin-right:8px; color:var(--muted);"></i>Session</b>
                <span class="badge" id="authBadge">Locked</span>
              </div>

              <div class="ddDivider"></div>

              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 6px 0;">
                <button class="btn" id="btnAuth" type="button" style="width:100%;">
                  <i class="fa-solid fa-right-to-bracket"></i> Login
                </button>
                <button class="btn" id="btnLogout" type="button" style="display:none; width:100%;">
                  <i class="fa-solid fa-right-from-bracket"></i> Sign out
                </button>
                <button class="btn" id="btnTheme" type="button" style="width:100%;">
                  <i class="fa-solid fa-circle-half-stroke"></i> Theme
                </button>
                <button class="btn primary" id="btnRefresh" type="button" style="width:100%;">
                  <i class="fa-solid fa-rotate"></i> Refresh
                </button>
              </div>

              <button class="btn" id="btnExport" type="button" style="width:100%; margin-top: 6px;">
                <i class="fa-solid fa-file-export"></i>
                Export CSV
              </button>

              <div class="hint" style="margin-top: 10px;">
                Tip: Search across calls + reservation intake. Useful keywords: “booking”, guest name, room type, event, call_id.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="mobileMenu" id="mobileMenu">
      <nav class="menu" aria-label="Mobile navigation">
        <a class="navItem active" href="#sec-overview"><i class="fa-solid fa-gauge-high"></i> Overview</a>
        <a class="navItem" href="#sec-activity"><i class="fa-solid fa-phone-volume"></i> Calls &amp; bookings</a>
        <a class="navItem" href="#sec-escalations"><i class="fa-solid fa-shield-halved"></i> Escalations</a>
        <a class="navItem" href="#sec-policies"><i class="fa-solid fa-sitemap"></i> Policies &amp; routing</a>
        <a class="navItem" href="#sec-export"><i class="fa-solid fa-file-export"></i> Export</a>
      </nav>
    </div>
  </header>

  <!-- APP ROOT -->
  <div class="page" id="appRoot">
    <div id="sec-overview"></div>

    <div class="subhead">
      <div>
        <h1>Elite operations overview</h1>
        <p>
          Live operations view for calls and reservation intake — filter by date range, search, refresh, and export activity.
        </p>
      </div>

      <div class="controls">
        <div class="chip">
          <label for="rangeSelect">Date</label>
          <select id="rangeSelect">
            <option value="today">Today</option>
            <option value="7" selected>Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="custom">Custom</option>
          </select>
        </div>

        <div class="chip">
          <label for="startDate">From</label>
          <input id="startDate" type="date" />
        </div>

        <div class="chip">
          <label for="endDate">To</label>
          <input id="endDate" type="date" />
        </div>
      </div>
    </div>

    <!-- KPI grid (rendered by app.js into #kpiGrid) -->
    <div class="grid" id="kpiGrid"></div>

    <!-- ✅ TIER A: OPS STRIP (UI-only, safe) -->
    <div class="opsStrip" id="opsStrip" aria-label="Operations status">
      <div class="opsLeft">
        <div class="opsTitle">
          <span class="dot" aria-hidden="true"></span>
          <div style="min-width:0;">
            <b>Demo-ready operations</b>
            <small>Keep the story tight: Answer → Intake → Summary → Escalate → Export</small>
          </div>
        </div>

        <div class="opsMeta">
          <div class="chipMini" title="Last refresh timestamp">
            <i class="fa-solid fa-clock"></i>
            <span id="lastUpdated">Updated —</span>
          </div>
          <div class="chipMini" title="Date window from app.js">
            <i class="fa-regular fa-calendar"></i>
            <span id="badgeWindowInline">Window: —</span>
          </div>
          <div class="chipMini" title="Total activity count from app.js">
            <i class="fa-solid fa-layer-group"></i>
            <span id="badgeCountInline">Items: 0</span>
          </div>
        </div>
      </div>

      <div class="opsActions">
        <a class="btn" href="#sec-activity" style="padding:10px 12px;">
          <i class="fa-solid fa-clock-rotate-left"></i> Activity
        </a>
        <button class="btn primary" type="button" id="btnTierARefresh" style="padding:10px 12px;">
          <i class="fa-solid fa-rotate"></i> Refresh
        </button>
        <button class="btn" type="button" id="btnTierAExport" style="padding:10px 12px;">
          <i class="fa-solid fa-download"></i> Export
        </button>
      </div>
    </div>

    <div class="layout">
      <!-- LEFT -->
      <main style="display:flex; flex-direction:column; gap: 14px; min-width:0;">

        <!-- ✅ TIER A: PERFORMANCE SNAPSHOT (Charts are drawn by app.js if it has renderChart; harmless if not) -->
        <section class="card" aria-label="Performance snapshot">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-chart-line" style="color: rgba(110,168,255,.95);"></i>
              Performance snapshot
            </h3>
            <span class="badge">last window</span>
          </div>
          <div class="cardBody">
            <div class="miniGrid">
              <div class="miniCard">
                <div class="miniHead">
                  <b><i class="fa-solid fa-phone"></i> Calls trend</b>
                  <span class="badge" style="background: rgba(110,168,255,.10);">spark</span>
                </div>
                <div class="chartWrap">
                  <canvas id="chartCalls" class="miniChart" width="520" height="120"></canvas>
                </div>
              </div>

              <div class="miniCard">
                <div class="miniHead">
                  <b><i class="fa-solid fa-calendar-check"></i> Bookings trend</b>
                  <span class="badge" style="background: rgba(66,211,146,.10); border-color: rgba(66,211,146,.22);">spark</span>
                </div>
                <div class="chartWrap">
                  <canvas id="chartBookings" class="miniChart" width="520" height="120"></canvas>
                </div>
              </div>
            </div>

            <div class="hint" style="margin-top:12px;">
              Trend lines show calls and booking activity across the selected window.
            </div>
          </div>
        </section>

        <!-- ACTIVITY -->
        <section class="card" id="sec-activity" aria-label="Calls and bookings activity">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-clock-rotate-left" style="color: rgba(110,168,255,.95);"></i>
              Activity feed
            </h3>
            <span style="display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px;">
              <span id="feedMeta">0 items</span>
            </span>
          </div>

          <div class="cardBody">
            <div class="filters" role="toolbar" aria-label="Feed filters" style="justify-content:space-between;">
              <div class="filters">
                <button class="segBtn active" type="button" data-filter="all" id="filterAll">
                  <i class="fa-solid fa-layer-group"></i> All
                  <span class="countBadge zero" id="countAll">0</span>
                </button>
                <button class="segBtn" type="button" data-filter="booking" id="filterBooking">
                  <i class="fa-solid fa-calendar-check"></i> Bookings
                  <span class="countBadge zero" id="countBookings">0</span>
                </button>
                <button class="segBtn" type="button" data-filter="call" id="filterCalls">
                  <i class="fa-solid fa-phone"></i> Calls
                  <span class="countBadge zero" id="countCalls">0</span>
                </button>

                <!-- Option B: visible but disabled -->
                <button class="segBtn disabled" type="button" data-filter="escalation" id="filterEscalations" aria-disabled="true" title="Coming soon">
                  <i class="fa-solid fa-shield-halved"></i> Escalations
                  <span class="countBadge zero" id="countEscalations">—</span>
                </button>
              </div>

              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <button class="btn primary" type="button" id="btnQuickRefresh" style="padding:10px 12px;">
                  <i class="fa-solid fa-rotate"></i> Refresh
                </button>
              </div>
            </div>

            <div id="stateBox"></div>

            <!-- ✅ Aliases for app.js (safe even if app.js doesn't use them) -->
            <div id="latestEmpty">
              <div id="feedEmpty" class="emptyState" style="margin-top:10px;">
                <div style="max-width: 560px;">
                  <div class="icon"><i class="fa-regular fa-calendar-xmark"></i></div>
                  <h4>No activity in the selected window</h4>
                  <p>When calls or booking intake are logged, they’ll appear here automatically.</p>
                </div>
              </div>
            </div>

            <div id="latestTableWrap" style="margin-top:10px;">
              <div class="tableWrap" id="feedTableWrap">
                <table>
                  <thead>
                    <tr>
                      <th style="width:150px;">Time</th>
                      <th style="width:90px;">Type</th>
                      <th style="width:180px;">Guest/Caller</th>
                      <th style="width:110px;">Arrival</th>
                      <th style="width:60px;">N</th>
                      <th style="width:110px;">Rate</th>
                      <th style="width:110px;">Total</th>
                      <th style="width:110px;">Sentiment</th>
                      <th>Summary</th>
                    </tr>
                  </thead>
                  <tbody id="feedTbody"></tbody>
                </table>
              </div>
            </div>

            <div style="margin-top:10px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:12px;">
              <div>Showing up to 500 items</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <span class="badge" id="badgeCountMini">0 items</span>
                <span class="badge" id="filterPill" style="display:none;">Filter: —</span>
              </div>
            </div>
          </div>
        </section>

        <!-- EXPORT -->
        <section class="card" id="sec-export" aria-label="Export and reporting">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-file-export" style="color: rgba(110,168,255,.95);"></i>
              Reporting &amp; export
            </h3>
            <span class="badge">CSV</span>
          </div>
          <div class="cardBody">
            <div class="hint">
              Export gives owners/managers a clean record of overnight handling (calls, reservation intake, outcomes, and summaries).
              Use it for audits, portfolio reporting, or staff follow-up.
            </div>

            <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
              <button class="btn primary" type="button" id="btnExportMirror">
                <i class="fa-solid fa-download"></i> Export CSV
              </button>
              <button class="btn" type="button" id="btnRefreshMirror">
                <i class="fa-solid fa-rotate"></i> Refresh data
              </button>
            </div>
          </div>
        </section>
      </main>

      <!-- RIGHT -->
      <aside style="display:flex; flex-direction:column; gap: 14px; min-width:0;">
        <!-- Workspace -->
        <section class="card" aria-label="Workspace snapshot">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-sliders" style="color: rgba(110,168,255,.95);"></i>
              Workspace
            </h3>
            <span style="color:var(--muted); font-size:12px;">quick view</span>
          </div>
          <div class="cardBody">
            <div style="display:flex; flex-direction:column; gap:10px;">
              <div class="pill">
                <b>Session</b>
                <span class="badge" id="authBadgeMirror">Locked</span>
              </div>
              <div class="pill">
                <b>Date range</b>
                <span class="badge" id="badgeWindowMirror">—</span>
              </div>
              <div class="pill">
                <b>Activity items</b>
                <span class="badge" id="badgeCountMirror">0</span>
              </div>
            </div>

            <div class="hint" style="margin-top: 12px;">
              Elite is built for real operations: policy-driven answers, reservation intake, clean summaries, and safe escalation routing.
            </div>
          </div>
        </section>

        <!-- ✅ TIER A: ATTENTION NEEDED (UI-only, app.js can inject opsInsights text if it wants) -->
        <section class="card" aria-label="Attention needed">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-triangle-exclamation" style="color: rgba(255,204,102,.95);"></i>
              Attention needed
            </h3>
            <span class="badge" style="background: rgba(255,204,102,.10); border-color: rgba(255,204,102,.22);">ops</span>
          </div>
          <div class="cardBody">
            <div class="hint">
              This card is what you talk through in the demo video: what matters overnight, what gets flagged, and what the owner can act on.
            </div>

            <!-- app.js-safe target (if present in your app.js it will populate) -->
            <div id="opsInsights" class="hint" style="margin-top:10px;"></div>

            <div class="todo" aria-label="Demo checklist">
              <div class="todoItem">
                <i class="fa-solid fa-bolt"></i>
                <div>
                  <b>Show 1–2 real calls</b><br/>
                  Click into “Calls” filter and highlight summary clarity + duration.
                </div>
              </div>
              <div class="todoItem">
                <i class="fa-solid fa-calendar-check"></i>
                <div>
                  <b>Show a booking intake</b><br/>
                  Point out arrival date, nights, total, and “clean summary”.
                </div>
              </div>
              <div class="todoItem">
                <i class="fa-solid fa-shield-halved"></i>
                <div>
                  <b>Explain escalation roadmap</b><br/>
                  Mention escalation routing is a planned upgrade (triage rules + contacts) and will appear here once enabled.
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Escalations -->
        <section class="card" id="sec-escalations" aria-label="Escalations">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-shield-halved" style="color: rgba(255,204,102,.95);"></i>
              Escalations
            </h3>
            <span class="badge" id="escalationBadge">Coming soon</span>
          </div>
          <div class="cardBody">
            <div class="hint">
              Escalations are not enabled in this Elite build yet. This panel becomes active once escalation events are logged and routed.
            </div>

            <div id="escalationsEmpty" class="emptyState" style="margin-top:10px;">
              <div style="max-width: 520px;">
                <div class="icon"><i class="fa-regular fa-circle-check"></i></div>
                <h4>Escalations not enabled</h4>
                <p>This area will populate once escalation logging + routing is turned on.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Policies -->
        <section class="card" id="sec-policies" aria-label="Policies and routing">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-sitemap" style="color: rgba(66,211,146,.95);"></i>
              Policies &amp; routing
            </h3>
            <span class="badge">configured</span>
          </div>
          <div class="cardBody">
            <div class="hint">
              Elite standardizes overnight handling across properties while preserving each hotel’s workflows.
              Changes to policies, fees, routing contacts, and escalation rules should be managed via your internal config process
              (not a public “extranet property editor”).
            </div>

            <div style="margin-top:12px; display:flex; flex-direction:column; gap:10px;">
              <div class="pill">
                <b><i class="fa-solid fa-bolt" style="margin-right:8px; color:var(--muted);"></i>Escalation rules</b>
                <span class="badge">On</span>
              </div>
              <div class="pill">
                <b><i class="fa-solid fa-language" style="margin-right:8px; color:var(--muted);"></i>Multi-language</b>
                <span class="badge">On</span>
              </div>
              <div class="pill">
                <b><i class="fa-solid fa-receipt" style="margin-right:8px; color:var(--muted);"></i>Payment capture</b>
                <span class="badge">Avoided</span>
              </div>
            </div>
          </div>
        </section>

      </aside>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Lightweight UI wiring (does NOT replace app.js) -->
  <script>
    // ============================================================
    // Dropdowns + mobile menu + nav active
    // ============================================================
    (function navUI(){
      const ddIds = ["ddUser"];
      const dds = ddIds.map(id => document.getElementById(id)).filter(Boolean);

      function closeAll(except){
        dds.forEach(dd => { if(dd !== except) dd.classList.remove("open"); });
      }

      dds.forEach(dd => {
        dd.addEventListener("click", (e) => {
          const isButton = e.target.closest("button");
          if(!isButton) return;
          const willOpen = !dd.classList.contains("open");
          closeAll(dd);
          dd.classList.toggle("open", willOpen);
        });
      });

      document.addEventListener("click", (e) => {
        if(e.target.closest(".dd")) return;
        closeAll(null);
      });

      const btnMobile = document.getElementById("btnMobileMenu");
      const mobileMenu = document.getElementById("mobileMenu");
      if(btnMobile && mobileMenu){
        btnMobile.addEventListener("click", () => mobileMenu.classList.toggle("open"));
      }

      const navLinks = Array.from(document.querySelectorAll('.navItem[href^="#"]'));
      function setActiveByHash(){
        const h = (location.hash || "#sec-overview").toLowerCase();
        navLinks.forEach(a => {
          const href = (a.getAttribute("href") || "").toLowerCase();
          a.classList.toggle("active", href === h);
        });
      }
      window.addEventListener("hashchange", setActiveByHash);
      setActiveByHash();
    })();

    // ============================================================
    // Wire quick buttons to your existing app.js buttons
    // ============================================================
    (function mirrors(){
      const quick = document.getElementById("btnQuickRefresh");
      const realRefresh = document.getElementById("btnRefresh");
      if(quick && realRefresh) quick.addEventListener("click", () => realRefresh.click());

      const exportMirror = document.getElementById("btnExportMirror");
      const realExport = document.getElementById("btnExport");
      if(exportMirror && realExport) exportMirror.addEventListener("click", () => realExport.click());

      const refreshMirror = document.getElementById("btnRefreshMirror");
      if(refreshMirror && realRefresh) refreshMirror.addEventListener("click", () => realRefresh.click());

      // Tier A buttons (safe)
      const tierARefresh = document.getElementById("btnTierARefresh");
      const tierAExport  = document.getElementById("btnTierAExport");
      if(tierARefresh && realRefresh) tierARefresh.addEventListener("click", () => realRefresh.click());
      if(tierAExport && realExport) tierAExport.addEventListener("click", () => realExport.click());
    })();

    // ============================================================
    // Feed filters (All / Booking / Call / Escalation)
    // - Does NOT affect fetching; only hides/shows rows already rendered by app.js.
    // ============================================================
    (function feedFilters(){
      const feedTbody = document.getElementById("feedTbody");
      const feedEmpty = document.getElementById("feedEmpty");
      const feedWrap = document.getElementById("feedTableWrap");
      const badgeCount = document.getElementById("badgeCount");
      const badgeWindow = document.getElementById("badgeWindow");
      const authBadge = document.getElementById("authBadge");

      // Tier A inline mirrors
      const badgeWindowInline = document.getElementById("badgeWindowInline");
      const badgeCountInline = document.getElementById("badgeCountInline");

      const mirrors = {
        badgeCountMini: document.getElementById("badgeCountMini"),
        badgeCountMirror: document.getElementById("badgeCountMirror"),
        badgeWindowMirror: document.getElementById("badgeWindowMirror"),
        authBadgeMirror: document.getElementById("authBadgeMirror"),
      };

      const filterPill = document.getElementById("filterPill");
      const feedMeta = document.getElementById("feedMeta");

      const btnAll = document.getElementById("filterAll");
      const btnBooking = document.getElementById("filterBooking");
      const btnCalls = document.getElementById("filterCalls");
      const btnEsc = document.getElementById("filterEscalations");

      const countAll = document.getElementById("countAll");
      const countBookings = document.getElementById("countBookings");
      const countCalls = document.getElementById("countCalls");
      const countEscalations = document.getElementById("countEscalations");

      const escalationBadge = document.getElementById("escalationBadge");
      const escalationsEmpty = document.getElementById("escalationsEmpty");

      const buttons = [btnAll, btnBooking, btnCalls, btnEsc].filter(Boolean);

      let active = "all";

      function setCount(el, n){
        if(!el) return;
        el.textContent = String(n);
        el.classList.toggle("zero", !n);
      }

      function rowType(tr){
        const ev = (tr.dataset.event || "").toLowerCase();
        if(ev) return ev;

        const tds = tr.querySelectorAll("td");
        const typeCell = (tds[1]?.textContent || "").toLowerCase().trim();

        if(typeCell.includes("book")) return "booking";
        if(typeCell.includes("reserv")) return "booking";
        if(typeCell.includes("escal")) return "escalation";
        if(typeCell.includes("urgent")) return "escalation";
        if(typeCell.includes("call")) return "call";

        // Summary column is now index 8 (because we inserted Rate at index 5)
        const summaryCell = (tds[8]?.textContent || "").toLowerCase();
        if(summaryCell.includes("escalat") || summaryCell.includes("urgent") || summaryCell.includes("911")) return "escalation";

        return typeCell || "call";
      }

      function compute(){
        if(!feedTbody) return { total:0, booking:0, call:0, escalation:0 };
        const rows = Array.from(feedTbody.querySelectorAll("tr"));
        let booking=0, call=0, escalation=0;
        rows.forEach(tr => {
          const t = rowType(tr);
          if(t.includes("booking")) booking++;
          else if(t.includes("escal")) escalation++;
          else call++;
        });
        return { total: rows.length, booking, call, escalation };
      }

      function apply(){
        if(!feedTbody) return;
        const rows = Array.from(feedTbody.querySelectorAll("tr"));
        let shown = 0;

        rows.forEach(tr => {
          const t = rowType(tr);
          let show = true;
          if(active === "booking") show = t.includes("booking");
          else if(active === "call") show = !t.includes("booking") && !t.includes("escal");
          else if(active === "escalation") show = t.includes("escal");
          tr.style.display = show ? "" : "none";
          if(show) shown++;
        });

        const hasAny = rows.length > 0;
        if(feedEmpty) feedEmpty.style.display = hasAny ? "none" : "";
        if(feedWrap) feedWrap.style.display = hasAny ? "" : "none";

        if(filterPill){
          if(active === "all") filterPill.style.display = "none";
          else{
            const label = active === "booking" ? "Bookings" : active === "call" ? "Calls" : "Escalations";
            filterPill.style.display = "";
            filterPill.textContent = "Filter: " + label + " (" + shown + ")";
          }
        }
      }

      function syncMirrors(){
        if(mirrors.badgeCountMini && badgeCount) mirrors.badgeCountMini.textContent = (badgeCount.textContent || "0") + " items";
        if(mirrors.badgeCountMirror && badgeCount) mirrors.badgeCountMirror.textContent = badgeCount.textContent || "0";
        if(mirrors.badgeWindowMirror && badgeWindow) mirrors.badgeWindowMirror.textContent = badgeWindow.textContent || "—";
        if(mirrors.authBadgeMirror && authBadge) mirrors.authBadgeMirror.textContent = authBadge.textContent || "Locked";

        if(badgeWindowInline && badgeWindow) badgeWindowInline.textContent = "Window: " + (badgeWindow.textContent || "—");
        if(badgeCountInline && badgeCount) badgeCountInline.textContent = "Items: " + (badgeCount.textContent || "0");
      }

      function updateCounts(){
        const c = compute();
        setCount(countAll, c.total);
        setCount(countBookings, c.booking);
        setCount(countCalls, c.call);

        // Escalations not enabled yet (Option B)
        if(countEscalations){
          countEscalations.textContent = "—";
          countEscalations.classList.add("zero");
        }

        if(feedMeta) feedMeta.textContent = c.total + " items";

        // Keep escalation panel honest (do not overwrite)
        if(escalationBadge) escalationBadge.textContent = "Coming soon";
        if(escalationsEmpty) escalationsEmpty.style.display = "";
      }

      function setActive(btn){
        buttons.forEach(b => b.classList.remove("active"));
        if(btn) btn.classList.add("active");
        active = (btn?.getAttribute("data-filter") || "all");
        updateCounts();
        apply();
      }

      buttons.forEach(btn => btn.addEventListener("click", () => setActive(btn)));

      const mo = new MutationObserver(() => {
        syncMirrors();
        updateCounts();
        apply();
      });
      [feedTbody, badgeCount, badgeWindow, authBadge].filter(Boolean).forEach(el => {
        mo.observe(el, { childList:true, subtree:true, characterData:true });
      });

      syncMirrors();
      updateCounts();
      apply();
    })();

    // ============================================================
    // KPI Enhancer (Tier A visual polish, UI-only)
    // - app.js renders .kpi with .name + .value
    // - we inject icon row + color classes without touching app.js
    // ============================================================
    (function enhanceKpis(){
      const grid = document.getElementById("kpiGrid");
      if(!grid) return;

      const iconFor = (label) => {
        const t = (label || "").toLowerCase();
        if(t.includes("total") && t.includes("call")) return "fa-phone";
        if(t.includes("book")) return "fa-calendar-check";
        if(t.includes("conver")) return "fa-arrow-trend-up";
        if(t.includes("revenue")) return "fa-dollar-sign";
        if(t.includes("avg")) return "fa-stopwatch";
        return "fa-gauge-high";
      };

      const classify = (label, valueText) => {
        const l = (label || "").toLowerCase();
        const v = (valueText || "").toLowerCase();

        if(l.includes("conversion")){
          const n = parseFloat(v.replace("%","").trim());
          if(Number.isFinite(n)){
            if(n >= 10) return "good";
            if(n >= 4) return "warn";
            return "bad";
          }
          return "";
        }
        if(l.includes("avg")){
          const n = parseFloat(v.replace("s","").trim());
          if(Number.isFinite(n)){
            if(n <= 90) return "good";
            if(n <= 160) return "warn";
            return "bad";
          }
          return "";
        }
        if(l.includes("revenue")){
          const n = parseFloat(v.replace(/[^0-9.\-]/g,""));
          if(Number.isFinite(n)){
            if(n >= 500) return "good";
            if(n >= 100) return "warn";
            return "";
          }
          return "";
        }
        return "";
      };

      function decorate(){
        const tiles = Array.from(grid.querySelectorAll(".kpi"));
        tiles.forEach(tile => {
          if(tile.dataset.enhanced === "1") return;

          const nameEl = tile.querySelector(".name");
          const valueEl = tile.querySelector(".value");
          const name = nameEl?.textContent || "";
          const value = valueEl?.textContent || "";

          // Insert top row
          const top = document.createElement("div");
          top.className = "kpiTop";
          top.innerHTML = `
            <div class="kpiIcon"><i class="fa-solid ${iconFor(name)}"></i></div>
            <p class="name">${name}</p>
          `;

          // Replace original name with our top row
          if(nameEl) nameEl.remove();
          tile.insertBefore(top, valueEl || tile.firstChild);

          // Apply class based on heuristics
          const cls = classify(name, value);
          if(cls) tile.classList.add(cls);

          tile.dataset.enhanced = "1";
        });
      }

      const mo = new MutationObserver(decorate);
      mo.observe(grid, { childList:true, subtree:true });
      decorate();
    })();

    // ============================================================
    // Show auth overlay by default until app.js hides it on session
    // ============================================================
    (function defaultAuthOverlay(){
      const overlay = document.getElementById("authOverlay");
      const authBadge = document.getElementById("authBadge");
      if(overlay) overlay.style.display = "flex";
      if(authBadge && (!authBadge.textContent || authBadge.textContent.trim() === "")){
        authBadge.textContent = "Locked";
      }
    })();
  </script>
</body>
</html>
