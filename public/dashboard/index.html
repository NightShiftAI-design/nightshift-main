<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NightShift AI ‚Ä¢ Dashboard</title>

  <meta name="robots" content="noindex,nofollow" />
  <meta name="color-scheme" content="dark light" />

  <!-- FAVICONS -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <!-- Icons (Font Awesome) -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- NOTE: This dashboard is self-styled (not relying on site.css) to avoid layout drift -->
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --accent: #6ea8ff;
      --good: #42d392;
      --warn: #ffcc66;
      --bad:  #ff6b6b;
      --shadow: 0 14px 46px rgba(0,0,0,.42);
      --radius: 18px;
      --radius2: 14px;
      --ring: 0 0 0 3px rgba(110,168,255,.20);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Light theme when html does NOT have .dark (v9.2 toggles html.dark) */
    html:not(.dark){
      --bg: #f6f7fb;
      --panel: rgba(10,15,25,.04);
      --panel2: rgba(10,15,25,.07);
      --border: rgba(10,15,25,.10);
      --text: rgba(10,15,25,.92);
      --muted: rgba(10,15,25,.62);
      --shadow: 0 12px 30px rgba(10,15,25,.10);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(110,168,255,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(66,211,146,.10), transparent 55%),
        radial-gradient(900px 700px at 50% 110%, rgba(255,204,102,.08), transparent 55%),
        var(--bg);
      overflow-x: hidden; /* ‚úÖ prevents Mac sideways scrolling */
    }

    /* ========= Layout ========= */
    .app{
      max-width: 1400px;
      margin: 0 auto;
      padding: 18px;
      min-height: 100vh;
    }

    .shell{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap: 14px;
      align-items:start;
    }

    @media (max-width: 1100px){
      .shell{ grid-template-columns: 1fr; }
    }

    .panel{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);
      min-width: 0; /* ‚úÖ prevent grid overflow */
    }

    /* ========= Sidebar ========= */
    .side{
      position: sticky;
      top: 18px;
      padding: 14px;
      height: fit-content;
    }
    @media (max-width: 1100px){
      .side{ position: static; }
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      text-decoration:none;
      color: inherit;
    }
    .brand:hover{ background: var(--panel2); }
    .brand .mark{
      width: 38px; height: 38px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(110,168,255,.16);
      border: 1px solid rgba(110,168,255,.28);
      font-weight: 950;
      letter-spacing: .02em;
    }
    .brand b{ display:block; font-weight: 950; }
    .brand small{ display:block; color: var(--muted); margin-top: 2px; }

    .sideBlock{ margin-top: 12px; }
    .sideTitle{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .12em;
      text-transform: uppercase;
      margin: 0 0 10px;
      font-weight: 900;
    }

    .stack{ display:flex; flex-direction:column; gap:10px; }

    .pill{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      min-width: 0;
    }
    .pill b{ font-size: 13px; }
    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(110,168,255,.14);
      white-space:nowrap;
    }

    .btnRow{ display:flex; flex-direction:column; gap:10px; }
    .btn{
      border-radius: 14px;
      padding: 11px 12px;
      font-weight: 900;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: var(--panel2);
      border-color: rgba(110,168,255,.35);
    }
    .btn:focus{ outline:none; box-shadow: var(--ring); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(110,168,255,.28), rgba(110,168,255,.16));
      border-color: rgba(110,168,255,.45);
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      padding: 12px;
      border-radius: 14px;
      border: 1px dashed var(--border);
      background: rgba(255,255,255,.03);
      line-height: 1.45;
    }

    /* ========= Main ========= */
    .main{ padding: 14px; }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      padding: 10px 10px 14px;
      border-bottom: 1px solid var(--border);
    }
    .title h1{
      margin: 0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: .01em;
    }
    .title p{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      max-width: 900px;
    }

    .controls{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items:center;
      justify-content:flex-end;
      min-width: 280px;
    }

    .chip{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
    }
    .chip label{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .chip select, .chip input{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      outline:none;
      min-width: 140px;
    }
    html:not(.dark) .chip select, html:not(.dark) .chip input{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .chip select:focus, .chip input:focus{ box-shadow: var(--ring); }

    .grid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      padding: 14px 10px 0;
    }
    @media (max-width: 1200px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px){ .grid{ grid-template-columns: 1fr; } }

    .kpi{
      border-radius: var(--radius2);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      padding: 12px;
      min-width: 0;
    }
    .kpi .name{
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-weight: 900;
    }
    .kpi .value{
      margin: 8px 0 0;
      font-size: 22px;
      font-weight: 950;
    }

    .content{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: 12px;
      padding: 12px 10px 10px;
      align-items:start;
    }
    @media (max-width: 1100px){
      .content{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      overflow:hidden;
      min-width: 0;
    }
    .cardHead{
      padding: 12px 12px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid var(--border);
    }
    .cardHead h3{
      margin:0;
      font-size: 13px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .cardBody{ padding: 12px; }

    .charts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 1100px){
      .charts{ grid-template-columns: 1fr; }
    }
    canvas{ width: 100%; height: 160px; display:block; }

    /* ‚úÖ Table horizontal scroll is contained inside wrapper, not page */
    .tableWrap{
      overflow:auto;
      border-radius: var(--radius2);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      max-width: 100%;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      min-width: 980px; /* it can scroll INSIDE wrapper */
      table-layout: fixed;
    }
    thead th{
      text-align:left;
      padding: 12px 10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      position: sticky;
      top: 0;
      z-index: 2;
      white-space: nowrap;
      backdrop-filter: blur(10px);
    }
    tbody td{
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      font-size: 13px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      vertical-align: top;
    }
    tbody tr:hover td{ background: rgba(110,168,255,.07); }

    .col-summary{ white-space: normal; }
    .summaryClamp{
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.35;
      max-height: calc(1.35em * 2);
    }

    /* State + toast (IDs used by app.js) */
    #stateBox{
      padding: 12px;
      border-radius: var(--radius2);
      border: 1px dashed var(--border);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      white-space: pre-wrap;
      margin-top: 10px;
    }
    #stateBox:empty{ display:none; }

    #toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      max-width: 360px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(10,15,25,.72);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      font-size: 13px;
      opacity: 0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 99;
    }
    html:not(.dark) #toast{ background: rgba(255,255,255,.78); }
    #toast.show{ opacity:1; transform: translateY(0); }

    /* Auth overlay (IDs used by app.js) */
    #authOverlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 999;
    }
    html:not(.dark) #authOverlay{ background: rgba(10,15,25,.22); }

    .authCard{
      width: min(520px, 100%);
      border-radius: 22px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .authHead{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .authHead b{ font-size: 14px; }
    .authHead span{ font-size: 12px; color: var(--muted); }

    .authBody{ padding: 16px; }
    .authBody p{ margin:0 0 12px; color: var(--muted); font-size: 13px; line-height:1.5; }

    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom: 12px; }
    .field label{ font-size: 12px; color: var(--muted); }
    .field input{
      width:100%;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px;
      border-radius: 14px;
      outline:none;
      font-size: 14px;
    }
    html:not(.dark) .field input{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .field input:focus{ box-shadow: var(--ring); }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .spacer{ flex:1; }

    /* Small link row */
    .overlayBackRow{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
    }
    .overlayBackRow a{
      color: var(--muted);
      font-size: 12px;
      text-decoration:none;
      border-bottom: 1px dashed transparent;
    }
    .overlayBackRow a:hover{
      color: var(--text);
      border-bottom-color: rgba(110,168,255,.45);
    }

    /* ============================================================
       Booking-style Extranet Layout Additions (keeps your theme)
    ============================================================ */

    /* Fixed top extranet nav */
    .topnav{
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(180deg, rgba(11,16,32,.92), rgba(11,16,32,.72));
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    html:not(.dark) .topnav{
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
      border-bottom-color: rgba(10,15,25,.10);
    }

    .topnavInner{
      max-width: 1400px;
      margin: 0 auto;
      padding: 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .navLeft, .navRight{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .navBrand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color: inherit;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
    }
    .navBrand:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.08);
    }
    html:not(.dark) .navBrand:hover{
      background: rgba(10,15,25,.04);
      border-color: rgba(10,15,25,.10);
    }

    .navBrand .mark{
      width: 36px; height: 36px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(110,168,255,.16);
      border: 1px solid rgba(110,168,255,.28);
      font-weight: 950;
      letter-spacing: .02em;
      flex:0 0 auto;
    }

    .navBrandText{
      display:flex;
      flex-direction:column;
      line-height: 1.05;
      min-width: 0;
    }
    .navBrandText b{ font-weight: 950; font-size: 13px; }
    .navBrandText small{
      color: var(--muted);
      font-size: 11px;
      margin-top: 3px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }

    .menu{
      display:flex;
      align-items:center;
      gap: 4px;
      padding: 6px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      overflow:auto;
      max-width: 760px;
      scrollbar-width: none;
    }
    .menu::-webkit-scrollbar{ display:none; }
    html:not(.dark) .menu{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }

    .navItem{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text);
      text-decoration:none;
      font-weight: 900;
      font-size: 13px;
      white-space: nowrap;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .navItem i{ opacity:.92; }
    .navItem:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.10);
      transform: translateY(-1px);
    }
    html:not(.dark) .navItem:hover{
      background: rgba(10,15,25,.04);
      border-color: rgba(10,15,25,.10);
    }
    .navItem.active{
      background: linear-gradient(180deg, rgba(110,168,255,.24), rgba(110,168,255,.12));
      border-color: rgba(110,168,255,.40);
      box-shadow: 0 0 0 3px rgba(110,168,255,.12);
    }

    .navPillBadge{
      margin-left: 2px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
    }
    .navPillBadge.good{
      border-color: rgba(66,211,146,.28);
      background: rgba(66,211,146,.10);
      color: var(--good);
    }

    .dotBadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
    }
    .dotBadge.accent{
      border-color: rgba(110,168,255,.45);
      background: rgba(110,168,255,.18);
    }

    .navSearch{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      min-width: 260px;
      max-width: 520px;
      flex: 1 1 320px;
    }
    html:not(.dark) .navSearch{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .navSearch i{ color: var(--muted); }
    .navSearch input{
      width: 100%;
      border: 0;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 13px;
    }
    .navIconBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    html:not(.dark) .navIconBtn{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .navIconBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.07);
      border-color: rgba(110,168,255,.35);
    }

    .flag{
      font-size: 16px;
      line-height: 1;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    html:not(.dark) .flag{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }

    /* Dropdown */
    .dd{ position: relative; }
    .ddPanel{
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      min-width: 320px;
      max-width: 380px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(11,16,32,.92);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      padding: 10px;
      display:none;
    }
    html:not(.dark) .ddPanel{
      background: rgba(255,255,255,.92);
      border-color: rgba(10,15,25,.12);
    }
    .dd.open .ddPanel{ display:block; }
    .ddGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    .ddItem{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: rgba(255,255,255,.03);
      text-decoration:none;
      color: var(--text);
      cursor:pointer;
    }
    html:not(.dark) .ddItem{ background: rgba(10,15,25,.03); }
    .ddItem:hover{
      background: rgba(110,168,255,.10);
      border-color: rgba(110,168,255,.28);
    }
    .ddItem i{
      margin-top: 2px;
      color: var(--muted);
      width: 18px;
      text-align:center;
      flex: 0 0 18px;
    }
    .ddItem b{
      display:block;
      font-size: 13px;
      font-weight: 950;
    }
    .ddItem small{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-top: 3px;
      line-height: 1.25;
    }
    .ddDivider{
      height: 1px;
      background: rgba(255,255,255,.10);
      margin: 8px 6px;
    }
    html:not(.dark) .ddDivider{ background: rgba(10,15,25,.10); }

    /* Main area spacing under nav */
    .page{
      max-width: 1400px;
      margin: 0 auto;
      padding: 18px;
    }

    /* Booking-like grid inside main */
    .extranetGrid{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 1100px){
      .extranetGrid{ grid-template-columns: 1fr; }
    }

    .subhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 8px 6px 12px;
    }
    .subhead h1{
      margin:0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: .01em;
    }
    .subhead p{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 13px;
    }

    /* Reservations ‚ÄúToday‚Äù selector + tabs */
    .resHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .resHeaderLeft{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      min-width: 0;
    }
    .resTitle{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .resTitle b{
      font-size: 14px;
      font-weight: 950;
      letter-spacing: .02em;
      white-space: nowrap;
    }
    .seg{
      display:flex;
      align-items:center;
      gap: 6px;
      padding: 6px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    html:not(.dark) .seg{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .segBtn{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text);
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      transition: background .12s ease, border-color .12s ease, transform .12s ease;
      white-space: nowrap;
    }
    .segBtn:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.10);
      transform: translateY(-1px);
    }
    .segBtn.active{
      background: rgba(110,168,255,.16);
      border-color: rgba(110,168,255,.35);
      box-shadow: 0 0 0 3px rgba(110,168,255,.10);
    }

    .countBadge{
      font-size: 11px;
      font-weight: 950;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--text);
    }
    .countBadge.zero{
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    html:not(.dark) .countBadge{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }

    .emptyState{
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 26px 14px;
      border-radius: var(--radius2);
      border: 1px dashed rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    html:not(.dark) .emptyState{
      border-color: rgba(10,15,25,.18);
      background: rgba(10,15,25,.03);
    }
    .emptyState .icon{
      width: 54px; height: 54px;
      border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(110,168,255,.12);
      border: 1px solid rgba(110,168,255,.22);
      color: rgba(110,168,255,.95);
      margin: 0 auto 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
    }
    html:not(.dark) .emptyState .icon{
      box-shadow: 0 10px 24px rgba(10,15,25,.10);
    }
    .emptyState h4{
      margin: 0;
      color: var(--text);
      font-weight: 950;
      font-size: 14px;
    }
    .emptyState p{
      margin: 8px 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .cardFoot{
      padding: 12px;
      border-top: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .linkBtn{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      text-decoration:none;
      font-weight: 950;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    html:not(.dark) .linkBtn{
      border-color: rgba(10,15,25,.12);
      background: rgba(10,15,25,.03);
    }
    .linkBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.07);
      border-color: rgba(110,168,255,.35);
    }

    /* Pending actions list */
    .todoList{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .todoItem{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    html:not(.dark) .todoItem{
      border-color: rgba(10,15,25,.10);
      background: rgba(10,15,25,.03);
    }
    .todoItem i{
      margin-top: 2px;
      color: rgba(110,168,255,.95);
      width: 18px;
      text-align:center;
    }
    .todoItem b{ display:block; font-size: 13px; font-weight: 950; }
    .todoItem span{ display:block; font-size: 12px; color: var(--muted); margin-top: 4px; line-height:1.35; }

    /* Advice illustration placeholder */
    .adviceHero{
      position: relative;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(520px 220px at 20% 25%, rgba(110,168,255,.22), transparent 55%),
        radial-gradient(520px 220px at 80% 55%, rgba(66,211,146,.16), transparent 55%),
        rgba(255,255,255,.03);
      padding: 14px;
      overflow:hidden;
    }
    html:not(.dark) .adviceHero{
      border-color: rgba(10,15,25,.12);
      background:
        radial-gradient(520px 220px at 20% 25%, rgba(110,168,255,.18), transparent 55%),
        radial-gradient(520px 220px at 80% 55%, rgba(66,211,146,.12), transparent 55%),
        rgba(10,15,25,.03);
    }

    .illus{
      display:flex;
      align-items:center;
      gap: 12px;
    }
    .illusArt{
      width: 64px; height: 64px;
      border-radius: 22px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 40px rgba(0,0,0,.30);
      position: relative;
      flex: 0 0 auto;
    }
    html:not(.dark) .illusArt{ box-shadow: 0 14px 30px rgba(10,15,25,.10); }
    .illusArt:before{
      content:"";
      position:absolute;
      inset: -22px -22px auto auto;
      width: 68px; height: 68px;
      border-radius: 999px;
      background: rgba(110,168,255,.18);
      filter: blur(0px);
    }
    .illusArt i{ font-size: 24px; color: rgba(110,168,255,.95); position: relative; z-index: 2; }

    .illusText b{ display:block; font-size: 13px; font-weight: 950; }
    .illusText span{ display:block; margin-top: 4px; font-size: 12px; color: var(--muted); line-height:1.35; }

    /* Mobile nav collapse */
    .mobileToggle{ display:none; }
    @media (max-width: 900px){
      .menu{ display:none; }
      .mobileToggle{ display:inline-flex; }
      .navSearch{ min-width: 0; flex: 1 1 auto; }
    }
    .mobileMenu{
      display:none;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 18px 12px;
    }
    .mobileMenu.open{ display:block; }
    .mobileMenu .menu{ display:flex; max-width: 100%; }

    /* Anchor scroll offsets for sticky nav */
    :target{ scroll-margin-top: 92px; }

    /* Optional: subtle section divider on mobile stacking */
    @media (max-width: 640px){
      .subhead{ flex-direction:column; align-items:flex-start; }
    }
  </style>

  <!-- Supabase JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Your config + app logic -->
  <script defer src="/dashboard/config.js"></script>
  <script defer src="/dashboard/app.js?v=1000"></script>
</head>

<body>
  <!-- AUTH OVERLAY (IDs expected by app.js) -->
  <div id="authOverlay" aria-hidden="true">
    <div class="authCard" role="dialog" aria-modal="true" aria-label="Sign in">
      <div class="authHead">
        <div>
          <b>Sign in to Dashboard</b><br/>
          <span>Magic link (email)</span>
        </div>
        <span id="authStatus">Not signed in</span>
      </div>

      <div class="authBody">
        <p>Enter your email and we‚Äôll send a secure magic link.</p>

        <div class="field">
          <label for="authEmail">Email</label>
          <input id="authEmail" type="email" placeholder="you@company.com" autocomplete="email" />
        </div>

        <div class="row">
          <button class="btn primary" id="btnSendLink" type="button">Send magic link</button>
          <button class="btn" id="btnResendLink" type="button">Resend</button>
          <span class="spacer"></span>
          <button class="btn" id="btnCloseAuth" type="button">Close</button>
        </div>

        <div class="overlayBackRow">
          <a href="/" aria-label="Back to NightShift AI homepage">‚Üê Back to NightShiftAI.com</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Top extranet nav (Booking-style) -->
  <header class="topnav" id="topnav">
    <div class="topnavInner">
      <div class="navLeft">
        <a class="navBrand" href="/" aria-label="Back to NightShift AI homepage">
          <div class="mark">NS</div>
          <div class="navBrandText">
            <b>NightShift AI</b>
            <small>Partner Extranet ‚Ä¢ Reservations</small>
          </div>
        </a>

        <button class="navIconBtn mobileToggle" id="btnMobileMenu" type="button" aria-label="Open menu">
          <i class="fa-solid fa-bars"></i>
        </button>

        <nav class="menu" aria-label="Primary navigation">
          <a class="navItem" href="#sec-top" data-nav="top">
            <i class="fa-solid fa-house"></i> Home
          </a>

          <a class="navItem" href="#sec-kpis" data-nav="kpis">
            <i class="fa-regular fa-calendar"></i> Rates &amp; availability
          </a>

          <a class="navItem" href="#sec-advice" data-nav="advice">
            <i class="fa-solid fa-bolt"></i> Promotions
          </a>

          <a class="navItem active" href="#sec-reservations" data-nav="reservations" aria-current="page">
            <i class="fa-solid fa-calendar-check"></i> Reservations
          </a>

          <!-- Property dropdown -->
          <div class="dd" id="ddProperty">
            <button class="navItem" id="btnPropertyDd" type="button" aria-haspopup="true" aria-expanded="false">
              <i class="fa-solid fa-building"></i> Property
              <i class="fa-solid fa-caret-down" style="margin-left:2px; opacity:.85;"></i>
            </button>

            <div class="ddPanel" role="menu" aria-label="Property menu">
              <div class="ddGrid">
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-star"></i>
                  <div><b>Quality rating</b><small>Maintain standards and performance</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-chart-line"></i>
                  <div><b>Property Page Score</b><small>Improve conversion on your listing</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-circle-info"></i>
                  <div><b>General info &amp; property status</b><small>Address, check-in, status</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-receipt"></i>
                  <div><b>VAT / Tax / Charges</b><small>Taxes, fees, and policies</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-regular fa-images"></i>
                  <div><b>Photos</b><small>Upload and manage images</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-shield-halved"></i>
                  <div><b>Policies</b><small>House rules and terms</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-list-check"></i>
                  <div><b>Facilities &amp; services</b><small>Amenities and services</small></div>
                </div>
                <div class="ddDivider"></div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-bed"></i>
                  <div><b>Room details</b><small>Inventory and configuration</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-wand-magic-sparkles"></i>
                  <div><b>Room amenities</b><small>What guests can expect</small></div>
                </div>
                <div class="ddDivider"></div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-user"></i>
                  <div><b>Your profile</b><small>Profile and security</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-language"></i>
                  <div><b>View your descriptions</b><small>See what guests see</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-envelope-open-text"></i>
                  <div><b>Messaging preferences</b><small>Guest comms settings</small></div>
                </div>
                <div class="ddItem" role="menuitem">
                  <i class="fa-solid fa-leaf"></i>
                  <div><b>Sustainability</b><small>Eco-friendly initiatives</small></div>
                </div>
              </div>
            </div>
          </div>

          <a class="navItem" href="#sec-performance" data-nav="performance">
            <i class="fa-solid fa-rocket"></i> Boost performance
            <span class="navPillBadge good">New</span>
          </a>

          <a class="navItem" href="#sec-messages" data-nav="messages">
            <i class="fa-solid fa-inbox"></i> Inbox
            <span class="dotBadge accent" id="inboxBadge">2</span>
          </a>

          <a class="navItem" href="#sec-latest" data-nav="latest">
            <i class="fa-solid fa-star-half-stroke"></i> Guest reviews
          </a>

          <a class="navItem" href="#sec-latest" data-nav="finance">
            <i class="fa-solid fa-dollar-sign"></i> Finance
          </a>

          <a class="navItem" href="#sec-kpis" data-nav="analytics">
            <i class="fa-solid fa-chart-pie"></i> Analytics
          </a>
        </nav>
      </div>

      <div class="navRight">
        <!-- Global search (mirrors app searchInput) -->
        <div class="navSearch" title="Search (guest, phone, event, room, call_id, summary‚Ä¶)">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="searchInput" type="text" placeholder="Search guest, phone, event, room, call_id, summary‚Ä¶" />
        </div>

        <div class="dd" id="ddLang">
          <button class="flag" id="btnLangDd" type="button" aria-label="Language">
            üá∫üá∏
          </button>
          <div class="ddPanel" style="right:0; left:auto; min-width: 240px;">
            <div class="ddGrid">
              <div class="ddItem" role="menuitem">
                <i class="fa-solid fa-flag-usa"></i>
                <div><b>English (US)</b><small>Default</small></div>
              </div>
              <div class="ddItem" role="menuitem">
                <i class="fa-solid fa-flag"></i>
                <div><b>Espa√±ol</b><small>Spanish</small></div>
              </div>
              <div class="ddItem" role="menuitem">
                <i class="fa-solid fa-flag"></i>
                <div><b>Fran√ßais</b><small>French</small></div>
              </div>
            </div>
          </div>
        </div>

        <button class="navIconBtn" type="button" aria-label="Help">
          <i class="fa-regular fa-circle-question"></i>
        </button>

        <!-- Quick actions (keeps your buttons/IDs) -->
        <div class="dd" id="ddUser">
          <button class="navIconBtn" id="btnUserDd" type="button" aria-label="Account menu">
            <i class="fa-regular fa-user"></i>
          </button>
          <div class="ddPanel" style="right:0; left:auto; min-width: 360px;">
            <div style="padding: 6px 6px 10px;">
              <div style="font-weight:950; font-size:13px;">Workspace</div>
              <div style="color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35;">
                Switch property, refresh data, theme, and session actions.
              </div>
            </div>

            <div class="ddDivider"></div>

            <div style="padding: 6px;">
              <!-- Property selector kept + moved -->
              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-hotel" style="margin-right:8px; color:var(--muted);"></i>Property</b>
                <select id="propertySelect" style="border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.06);color:var(--text);padding:8px 10px;outline:none;max-width: 180px;">
                  <option value="__all__">All properties</option>
                </select>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-regular fa-calendar" style="margin-right:8px; color:var(--muted);"></i>Date range</b>
                <span class="badge" id="badgeWindow">‚Äî</span>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-layer-group" style="margin-right:8px; color:var(--muted);"></i>Activity items</b>
                <span class="badge" id="badgeCount">0</span>
              </div>

              <div class="pill" style="margin: 6px 0;">
                <b><i class="fa-solid fa-lock" style="margin-right:8px; color:var(--muted);"></i>Session</b>
                <span class="badge" id="authBadge">Locked</span>
              </div>

              <div class="ddDivider"></div>

              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 6px 0;">
                <button class="btn" id="btnAuth" type="button" style="width:100%;">Login</button>
                <button class="btn" id="btnLogout" type="button" style="display:none; width:100%;">Sign out</button>
                <button class="btn" id="btnTheme" type="button" style="width:100%;">Theme</button>
                <button class="btn primary" id="btnRefresh" type="button" style="width:100%;">Refresh</button>
              </div>

              <button class="btn" id="btnExport" type="button" style="width:100%; margin-top: 6px;">
                <i class="fa-solid fa-file-export" style="margin-right:8px;"></i>
                Export CSV
              </button>

              <div class="hint" style="margin-top: 10px;">
                Tip: Search across calls + bookings. Use keywords like ‚Äúbooking‚Äù, guest name, room type, event, or call_id.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Mobile menu row -->
    <div class="mobileMenu" id="mobileMenu">
      <nav class="menu" aria-label="Mobile navigation">
        <a class="navItem" href="#sec-top"><i class="fa-solid fa-house"></i> Home</a>
        <a class="navItem" href="#sec-kpis"><i class="fa-regular fa-calendar"></i> Rates &amp; availability</a>
        <a class="navItem" href="#sec-advice"><i class="fa-solid fa-bolt"></i> Promotions</a>
        <a class="navItem active" href="#sec-reservations"><i class="fa-solid fa-calendar-check"></i> Reservations</a>
        <a class="navItem" href="#sec-performance"><i class="fa-solid fa-rocket"></i> Boost performance <span class="navPillBadge good">New</span></a>
        <a class="navItem" href="#sec-messages"><i class="fa-solid fa-inbox"></i> Inbox <span class="dotBadge accent">2</span></a>
        <a class="navItem" href="#sec-latest"><i class="fa-solid fa-star-half-stroke"></i> Guest reviews</a>
        <a class="navItem" href="#sec-kpis"><i class="fa-solid fa-dollar-sign"></i> Finance</a>
        <a class="navItem" href="#sec-kpis"><i class="fa-solid fa-chart-pie"></i> Analytics</a>
      </nav>
    </div>
  </header>

  <!-- APP (keeps your IDs used by app.js; redesigned layout) -->
  <div class="page" id="appRoot">
    <div id="sec-top"></div>

    <!-- KPI grid (rendered by app.js into #kpiGrid) -->
    <div class="subhead">
      <div>
        <h1>Reservations overview</h1>
        <p>Today‚Äôs arrivals/departures and your latest activity ‚Äî styled like a real hotel extranet.</p>
      </div>

      <!-- Date controls (keep IDs rangeSelect/startDate/endDate) -->
      <div class="controls" style="margin:0; padding:0;">
        <div class="chip">
          <label for="rangeSelect">Date</label>
          <select id="rangeSelect">
            <option value="today">Today</option>
            <option value="7" selected>Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="custom">Custom</option>
          </select>
        </div>

        <div class="chip">
          <label for="startDate">From</label>
          <input id="startDate" type="date" />
        </div>

        <div class="chip">
          <label for="endDate">To</label>
          <input id="endDate" type="date" />
        </div>
      </div>
    </div>

    <div id="sec-kpis" class="grid" id="kpiGrid"></div>
    <!-- NOTE: keep only one id="kpiGrid" -->
    <div class="grid" id="kpiGrid"></div>

    <div class="extranetGrid">
      <!-- LEFT/CENTER COLUMN -->
      <div style="display:flex; flex-direction:column; gap: 14px; min-width:0;">

        <!-- Big Reservations card (Today + tabs + empty state) -->
        <section class="card" aria-label="Reservations card" id="sec-reservations">
          <div class="cardHead">
            <h3 style="display:flex; align-items:center; gap:10px;">
              <i class="fa-solid fa-calendar-check" style="color: rgba(110,168,255,.95);"></i>
              Reservations
            </h3>
            <span style="display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px;">
              <span id="feedMeta">0 items</span>
            </span>
          </div>

          <div class="cardBody">
            <div class="resHeader">
              <div class="resHeaderLeft">
                <div class="resTitle">
                  <b>Today</b>
                  <span class="badge" id="todayLabel" title="Selected date">‚Äî</span>
                </div>

                <div class="seg" role="tablist" aria-label="Reservation segments">
                  <button class="segBtn active" id="tabArrivals" type="button" data-seg="arrivals">
                    <i class="fa-solid fa-arrow-down"></i> Arrivals
                    <span class="countBadge zero" id="countArrivals">0</span>
                  </button>
                  <button class="segBtn" id="tabDepartures" type="button" data-seg="departures">
                    <i class="fa-solid fa-arrow-up"></i> Departures
                    <span class="countBadge zero" id="countDepartures">0</span>
                  </button>
                  <button class="segBtn" id="tabStayovers" type="button" data-seg="stayovers">
                    <i class="fa-solid fa-moon"></i> Stay-overs
                    <span class="countBadge zero" id="countStayovers">0</span>
                  </button>
                  <button class="segBtn" id="tabRequests" type="button" data-seg="requests">
                    <i class="fa-solid fa-bell-concierge"></i> Guest requests
                    <span class="countBadge zero" id="countRequests">0</span>
                  </button>
                </div>
              </div>

              <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                <button class="btn primary" type="button" id="btnQuickRefresh" style="padding:10px 12px;">
                  <i class="fa-solid fa-rotate" style="margin-right:8px;"></i> Refresh
                </button>
              </div>
            </div>

            <!-- Placeholder / ‚Äúno arrivals‚Äù -->
            <div id="reservationsEmpty" class="emptyState" style="margin-top: 12px;">
              <div style="max-width: 520px;">
                <div class="icon"><i class="fa-regular fa-file-lines"></i></div>
                <h4 id="reservationsEmptyTitle">No arrivals for selected date</h4>
                <p id="reservationsEmptyDesc">
                  When bookings come in, they‚Äôll show here by segment (arrivals, departures, stay-overs, and requests).
                </p>
              </div>
            </div>

            <div class="cardFoot">
              <div style="color:var(--muted); font-size:12px;">
                <span id="lastUpdated">Updated ‚Äî</span>
              </div>
              <a class="linkBtn" href="#sec-latest" aria-label="View all reservations" id="btnViewAllReservations">
                View all reservations
                <i class="fa-solid fa-arrow-right"></i>
              </a>
            </div>
          </div>
        </section>

        <!-- Latest reservations card (uses your existing table + #feedTbody) -->
        <section class="card" aria-label="Latest reservations" id="sec-latest">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-clock-rotate-left" style="margin-right:10px; color: rgba(110,168,255,.95);"></i>
              Latest reservations
            </h3>
            <span class="badge" id="latestWindowBadgeReminder" title="Window is driven by your date range selector">Last 60 days</span>
          </div>

          <div class="cardBody">
            <!-- app.js state box stays -->
            <div id="stateBox"></div>

            <!-- Empty placeholder shown when table has no rows -->
            <div id="latestEmpty" class="emptyState" style="margin-top:10px;">
              <div style="max-width: 560px;">
                <div class="icon"><i class="fa-regular fa-calendar-xmark"></i></div>
                <h4>You haven‚Äôt received any bookings in the last 60 days</h4>
                <p>
                  Once new calls or reservations are logged, they‚Äôll appear here automatically.
                </p>
              </div>
            </div>

            <!-- Table wrapper (keeps your table + IDs) -->
            <div class="tableWrap" id="latestTableWrap" style="margin-top:10px;">
              <table>
                <thead>
                  <tr>
                    <th style="width:150px;">Time</th>
                    <th style="width:90px;">Type</th>
                    <th style="width:180px;">Guest/Caller</th>
                    <th style="width:110px;">Arrival</th>
                    <th style="width:60px;">N</th>
                    <th style="width:110px;">Total</th>
                    <th style="width:110px;">Sentiment</th>
                    <th>Summary</th>
                  </tr>
                </thead>
                <tbody id="feedTbody"></tbody>
              </table>
            </div>

            <div style="margin-top:10px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:12px;">
              <div>Showing up to 500 items</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <span class="badge" id="badgeCountMini">0 items</span>
                <span class="badge" id="filterPill" style="display:none;">Filter: ‚Äî</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Unanswered messages card -->
        <section class="card" aria-label="Unanswered messages" id="sec-messages">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-message" style="margin-right:10px; color: rgba(110,168,255,.95);"></i>
              Unanswered messages
            </h3>
            <span class="badge" id="unansweredBadge">0</span>
          </div>

          <div class="cardBody">
            <div id="unansweredEmpty" class="emptyState">
              <div style="max-width: 520px;">
                <div class="icon"><i class="fa-regular fa-face-smile"></i></div>
                <h4>No unanswered messages</h4>
                <p>
                  Great ‚Äî your guest inbox reminder list is clear.
                </p>
              </div>
            </div>
          </div>
        </section>

      </div>

      <!-- RIGHT SIDEBAR COLUMN (Booking-style) -->
      <aside style="display:flex; flex-direction:column; gap: 14px; min-width:0;">

        <!-- Workspace snapshot -->
        <section class="card" aria-label="Workspace snapshot">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-sliders" style="margin-right:10px; color: rgba(110,168,255,.95);"></i>
              Workspace
            </h3>
            <span style="color:var(--muted); font-size:12px;">quick view</span>
          </div>
          <div class="cardBody">
            <div class="stack">
              <div class="pill">
                <b>Session</b>
                <span class="badge" id="authBadgeMirror">Locked</span>
              </div>
              <div class="pill">
                <b>Date range</b>
                <span class="badge" id="badgeWindowMirror">‚Äî</span>
              </div>
              <div class="pill">
                <b>Activity items</b>
                <span class="badge" id="badgeCountMirror">0</span>
              </div>
            </div>

            <div class="hint" style="margin-top: 12px;">
              Pro tip: Use the top search to instantly find a caller, guest name, arrival date, or call_id.
            </div>
          </div>
        </section>

        <!-- ‚úÖ MOVED: Performance insights now sits directly under Workspace (your request) -->
        <section class="card" aria-label="Performance insights" id="sec-performance">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-wand-magic-sparkles" style="margin-right:10px; color: rgba(66,211,146,.95);"></i>
              Performance insights
            </h3>
            <span style="color:var(--muted); font-size:12px;">triage ‚Ä¢ by day</span>
          </div>

          <div class="cardBody">
            <div style="display:grid; grid-template-columns: 1fr; gap: 12px;">
              <div class="card" style="padding:12px;">
                <div style="font-weight:900; font-size:12px; color:var(--muted); letter-spacing:.12em; text-transform:uppercase;">Ops insights</div>
                <div id="opsInsights" style="color:var(--muted); white-space:pre-wrap; margin-top: 8px;">‚Äî</div>
              </div>

              <div class="charts">
                <div class="card" style="padding:12px;">
                  <div style="font-weight:900; font-size:12px; color:var(--muted); letter-spacing:.12em; text-transform:uppercase;">Calls</div>
                  <canvas id="chartCalls" width="600" height="200"></canvas>
                </div>
                <div class="card" style="padding:12px;">
                  <div style="font-weight:900; font-size:12px; color:var(--muted); letter-spacing:.12em; text-transform:uppercase;">Bookings</div>
                  <canvas id="chartBookings" width="600" height="200"></canvas>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Pending actions -->
        <section class="card" aria-label="Pending actions" id="sec-actions">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-list-check" style="margin-right:10px; color: rgba(255,204,102,.95);"></i>
              Pending actions
            </h3>
            <span class="badge" id="pendingBadge">3</span>
          </div>
          <div class="cardBody">
            <div class="todoList">
              <div class="todoItem">
                <i class="fa-solid fa-circle-exclamation"></i>
                <div>
                  <b>Review missed-call escalations</b>
                  <span>Confirm after-hours workflows and emergency contacts are current.</span>
                </div>
              </div>
              <div class="todoItem">
                <i class="fa-solid fa-image"></i>
                <div>
                  <b>Improve listing photos</b>
                  <span>Fresh photos can increase conversion and reduce repetitive questions.</span>
                </div>
              </div>
              <div class="todoItem">
                <i class="fa-solid fa-shield"></i>
                <div>
                  <b>Confirm policies</b>
                  <span>Double-check pet, smoking, and deposit policies for clean handoffs.</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Advice / opportunity center -->
        <section class="card" aria-label="Advice" id="sec-advice">
          <div class="cardHead">
            <h3>
              <i class="fa-solid fa-rocket" style="margin-right:10px; color: rgba(110,168,255,.95);"></i>
              Advice
            </h3>
            <span class="badge">Boost</span>
          </div>
          <div class="cardBody">
            <div class="adviceHero">
              <div class="illus">
                <div class="illusArt" aria-hidden="true">
                  <i class="fa-solid fa-folder-open"></i>
                </div>
                <div class="illusText">
                  <b>Opportunity Center</b>
                  <span>
                    Quick wins to improve guest experience and booking performance ‚Äî tailored to your activity.
                  </span>
                </div>
              </div>

              <div style="margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap;">
                <a class="linkBtn" href="javascript:void(0)" aria-label="Open the Opportunity Center" style="flex:1; justify-content:center;">
                  <i class="fa-solid fa-arrow-up-right-from-square"></i>
                  Open the Opportunity Center
                </a>
              </div>
            </div>
          </div>
        </section>

      </aside>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Lightweight UI wiring (does NOT replace app.js; just handles layout + placeholders + nav + segment filtering) -->
  <script>
    // ============================================================
    // Dropdowns + mobile menu
    // ============================================================
    (function navUI(){
      const ddIds = ["ddProperty","ddLang","ddUser"];
      const dds = ddIds.map(id => document.getElementById(id)).filter(Boolean);

      function closeAll(except){
        dds.forEach(dd => {
          if(dd !== except) dd.classList.remove("open");
        });
      }

      dds.forEach(dd => {
        dd.addEventListener("click", (e) => {
          const isButton = e.target.closest("button");
          if(!isButton) return;
          const willOpen = !dd.classList.contains("open");
          closeAll(dd);
          dd.classList.toggle("open", willOpen);
        });
      });

      document.addEventListener("click", (e) => {
        if(e.target.closest(".dd")) return;
        closeAll(null);
      });

      const btnMobile = document.getElementById("btnMobileMenu");
      const mobileMenu = document.getElementById("mobileMenu");
      if(btnMobile && mobileMenu){
        btnMobile.addEventListener("click", () => {
          mobileMenu.classList.toggle("open");
        });
      }

      // make nav "active" based on hash (simple)
      const navLinks = Array.from(document.querySelectorAll('.navItem[href^="#"]'));
      function setActiveByHash(){
        const h = (location.hash || "#sec-reservations").toLowerCase();
        navLinks.forEach(a => a.classList.toggle("active", a.getAttribute("href").toLowerCase() === h));
      }
      window.addEventListener("hashchange", setActiveByHash);
      setActiveByHash();
    })();

    // ============================================================
    // Wire quick refresh button to your existing #btnRefresh
    // ============================================================
    (function quickRefresh(){
      const quick = document.getElementById("btnQuickRefresh");
      const real = document.getElementById("btnRefresh");
      if(quick && real){
        quick.addEventListener("click", () => real.click());
      }
    })();

    // ============================================================
    // Segment logic (Arrivals/Departures/Stayovers/Requests)
    // - Uses dataset if app.js provides it on <tr>:
    //     tr.dataset.arrival = "YYYY-MM-DD"
    //     tr.dataset.nights = "2"
    //     tr.dataset.event = "booking" / "call" / "message" / "request" ...
    // - Falls back to best-effort heuristic reading cells.
    // ============================================================
    (function segmentsAndPlaceholders(){
      const badgeCount = document.getElementById("badgeCount");
      const badgeWindow = document.getElementById("badgeWindow");
      const authBadge = document.getElementById("authBadge");

      const mirrors = {
        badgeCountMini: document.getElementById("badgeCountMini"),
        badgeCountMirror: document.getElementById("badgeCountMirror"),
        badgeWindowMirror: document.getElementById("badgeWindowMirror"),
        authBadgeMirror: document.getElementById("authBadgeMirror")
      };

      const todayLabel = document.getElementById("todayLabel");
      const rs = document.getElementById("rangeSelect");
      const sd = document.getElementById("startDate");
      const ed = document.getElementById("endDate");

      const feedTbody = document.getElementById("feedTbody");
      const latestEmpty = document.getElementById("latestEmpty");
      const latestWrap = document.getElementById("latestTableWrap");

      const countArrivals = document.getElementById("countArrivals");
      const countDepartures = document.getElementById("countDepartures");
      const countStayovers = document.getElementById("countStayovers");
      const countRequests = document.getElementById("countRequests");
      const reservationsEmpty = document.getElementById("reservationsEmpty");
      const reservationsEmptyTitle = document.getElementById("reservationsEmptyTitle");
      const reservationsEmptyDesc = document.getElementById("reservationsEmptyDesc");
      const filterPill = document.getElementById("filterPill");

      const tabs = [
        document.getElementById("tabArrivals"),
        document.getElementById("tabDepartures"),
        document.getElementById("tabStayovers"),
        document.getElementById("tabRequests")
      ].filter(Boolean);

      let activeSeg = "arrivals";

      function setBadge(el, n){
        if(!el) return;
        el.textContent = String(n);
        el.classList.toggle("zero", !n);
      }

      function parseISODate(s){
        if(!s) return null;
        const m = String(s).trim().match(/^(\d{4})-(\d{2})-(\d{2})/);
        if(!m) return null;
        const y = Number(m[1]), mo = Number(m[2]) - 1, d = Number(m[3]);
        return new Date(y, mo, d);
      }
      function sameDay(a,b){
        return a && b &&
          a.getFullYear()===b.getFullYear() &&
          a.getMonth()===b.getMonth() &&
          a.getDate()===b.getDate();
      }
      function addDays(date, days){
        const d = new Date(date);
        d.setDate(d.getDate() + Number(days || 0));
        return d;
      }

      function getSelectedDate(){
        // For the "Today" segments card:
        // - if rangeSelect is today: use today's date
        // - if custom: use startDate as the selected day for segment breakdown
        // - otherwise: also use today's date (keeps it simple + Booking-like)
        if(rs && rs.value === "custom" && sd && sd.value){
          const d = parseISODate(sd.value);
          if(d) return d;
        }
        return new Date();
      }

      function syncTodayLabel(){
        if(!todayLabel || !rs) return;
        const v = rs.value;
        if(v === "today"){
          const d = new Date();
          todayLabel.textContent = d.toLocaleDateString(undefined, { weekday:"short", month:"short", day:"numeric" });
        }else if(v === "custom" && sd && ed && sd.value && ed.value){
          todayLabel.textContent = sd.value + " ‚Üí " + ed.value;
        }else{
          todayLabel.textContent = "Last " + v + " days";
        }
      }

      function syncMirrors(){
        if(mirrors.badgeCountMini && badgeCount) mirrors.badgeCountMini.textContent = (badgeCount.textContent || "0") + " items";
        if(mirrors.badgeCountMirror && badgeCount) mirrors.badgeCountMirror.textContent = badgeCount.textContent || "0";
        if(mirrors.badgeWindowMirror && badgeWindow) mirrors.badgeWindowMirror.textContent = badgeWindow.textContent || "‚Äî";
        if(mirrors.authBadgeMirror && authBadge) mirrors.authBadgeMirror.textContent = authBadge.textContent || "Locked";
      }

      function classifyRow(tr, selectedDate){
        // Prefer dataset (future-proof; update app.js to set these on each row)
        const dsArrival = tr.dataset.arrival || "";
        const dsNights = tr.dataset.nights || "";
        const dsEvent = (tr.dataset.event || "").toLowerCase();

        const tds = tr.querySelectorAll("td");
        const typeCell = (tds[1]?.textContent || "").toLowerCase();
        const arrivalCell = (tds[3]?.textContent || "").trim();
        const nightsCell = (tds[4]?.textContent || "").trim();
        const summaryCell = (tds[7]?.textContent || "").toLowerCase();

        const arrivalStr = dsArrival || arrivalCell;
        const nightsVal = Number(dsNights || nightsCell || 0);
        const arrivalDate = parseISODate(arrivalStr);

        // Requests
        const looksLikeRequest =
          dsEvent.includes("request") || dsEvent.includes("message") ||
          typeCell.includes("request") || typeCell.includes("message") ||
          summaryCell.includes("request") || summaryCell.includes("message");

        // Segment date logic
        let isArrival = false, isDeparture = false, isStayover = false;

        if(arrivalDate){
          const depDate = addDays(arrivalDate, nightsVal || 0);
          isArrival = sameDay(arrivalDate, selectedDate);
          isDeparture = (nightsVal > 0) ? sameDay(depDate, selectedDate) : false;
          isStayover = (nightsVal > 0) ? (selectedDate > arrivalDate && selectedDate < depDate) : false;
        }

        // Fallback if no arrival_date parseable: use type text hints
        if(!arrivalDate){
          isArrival = typeCell.includes("arrival");
          isDeparture = typeCell.includes("departure");
          isStayover = typeCell.includes("stay");
        }

        return { isArrival, isDeparture, isStayover, isRequest: looksLikeRequest };
      }

      function computeCounts(){
        if(!feedTbody) return { total:0, arrivals:0, departures:0, stayovers:0, requests:0 };
        const rows = Array.from(feedTbody.querySelectorAll("tr"));
        const selected = getSelectedDate();

        let arrivals=0, departures=0, stayovers=0, requests=0;

        rows.forEach(tr => {
          const c = classifyRow(tr, selected);
          if(c.isArrival) arrivals++;
          if(c.isDeparture) departures++;
          if(c.isStayover) stayovers++;
          if(c.isRequest) requests++;
        });

        return { total: rows.length, arrivals, departures, stayovers, requests };
      }

      function applySegmentFilter(){
        if(!feedTbody) return;
        const selected = getSelectedDate();
        const rows = Array.from(feedTbody.querySelectorAll("tr"));

        let matchCount = 0;

        rows.forEach(tr => {
          const c = classifyRow(tr, selected);
          let show = true;
          if(activeSeg === "arrivals") show = c.isArrival;
          else if(activeSeg === "departures") show = c.isDeparture;
          else if(activeSeg === "stayovers") show = c.isStayover;
          else if(activeSeg === "requests") show = c.isRequest;

          tr.style.display = show ? "" : "none";
          if(show) matchCount++;
        });

        if(filterPill){
          filterPill.style.display = "";
          const label =
            activeSeg === "arrivals" ? "Arrivals" :
            activeSeg === "departures" ? "Departures" :
            activeSeg === "stayovers" ? "Stay-overs" :
            "Guest requests";
          filterPill.textContent = "Filter: " + label + " (" + matchCount + ")";
        }

        // update big empty state copy depending on active segment
        if(reservationsEmptyTitle && reservationsEmptyDesc){
          if(activeSeg === "arrivals"){
            reservationsEmptyTitle.textContent = "No arrivals for selected date";
            reservationsEmptyDesc.textContent = "Arrivals will appear here when bookings match the selected date.";
          }else if(activeSeg === "departures"){
            reservationsEmptyTitle.textContent = "No departures for selected date";
            reservationsEmptyDesc.textContent = "Departures appear when arrival_date + nights matches the selected date.";
          }else if(activeSeg === "stayovers"){
            reservationsEmptyTitle.textContent = "No stay-overs for selected date";
            reservationsEmptyDesc.textContent = "Stay-overs appear when a guest is between arrival and departure.";
          }else{
            reservationsEmptyTitle.textContent = "No guest requests";
            reservationsEmptyDesc.textContent = "Guest requests/messages will appear here when flagged by event/type.";
          }
        }

        // Show/hide big empty state:
        if(reservationsEmpty){
          reservationsEmpty.style.display = matchCount > 0 ? "none" : "";
        }
      }

      function syncTableEmptyState(){
        const hasAnyRows = !!(feedTbody && feedTbody.children && feedTbody.children.length > 0);
        if(latestEmpty) latestEmpty.style.display = hasAnyRows ? "none" : "";
        if(latestWrap) latestWrap.style.display = hasAnyRows ? "" : "none";
      }

      function syncCountsAndUI(){
        const c = computeCounts();
        setBadge(countArrivals, c.arrivals);
        setBadge(countDepartures, c.departures);
        setBadge(countStayovers, c.stayovers);
        setBadge(countRequests, c.requests);

        // If the table has no rows at all, big reservations card should show empty too
        const anyTotal = c.total > 0;
        if(!anyTotal && reservationsEmpty){
          reservationsEmpty.style.display = "";
        }

        applySegmentFilter();
      }

      function wireTabs(){
        tabs.forEach(btn => {
          btn.addEventListener("click", () => {
            tabs.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            activeSeg = btn.getAttribute("data-seg") || "arrivals";
            syncCountsAndUI();
          });
        });
      }

      // Observe changes from app.js
      const mo = new MutationObserver(() => {
        syncMirrors();
        syncTodayLabel();
        syncTableEmptyState();
        syncCountsAndUI();
      });

      [badgeCount, badgeWindow, authBadge, feedTbody].filter(Boolean).forEach(el => {
        mo.observe(el, { childList:true, subtree:true, characterData:true });
      });

      // Update on date changes
      [rs, sd, ed].filter(Boolean).forEach(el => el.addEventListener("change", () => {
        syncTodayLabel();
        setTimeout(() => {
          syncTableEmptyState();
          syncCountsAndUI();
        }, 60);
      }));

      // Init
      wireTabs();
      syncMirrors();
      syncTodayLabel();
      syncTableEmptyState();
      syncCountsAndUI();
    })();

    // ============================================================
    // ‚úÖ Restore "login page like before":
    // Show auth overlay by default until app.js decides otherwise.
    // (App.js will still control session state and can hide it on auth.)
    // ============================================================
    (function defaultAuthOverlay(){
      const overlay = document.getElementById("authOverlay");
      const authBadge = document.getElementById("authBadge");
      // If app.js later hides it, great. If not logged in, user sees proper login.
      if(overlay) overlay.style.display = "flex";
      if(authBadge && (!authBadge.textContent || authBadge.textContent.trim() === "")){
        authBadge.textContent = "Locked";
      }
    })();
  </script>
</body>
</html>
